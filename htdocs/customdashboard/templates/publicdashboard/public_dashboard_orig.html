<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->
        <!-- This was not in the repo when cloned #TODO is it needed?
        <link rel="stylesheet" href="css/normalize.css">
        -->
        <link rel="stylesheet" href="{{ STATIC_URL }}publicdashboard/css/main.css">
                <!--- Hosted Leaflet CSS --->
        <link rel="stylesheet" href="{{ STATIC_URL }}css/leaflet.css">
        <script src="{{ STATIC_URL }}publicdashboard/js/vendor/modernizr-2.8.3.min.js"></script>
        <script src="https://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
        <script src="{{ STATIC_URL }}publicdashboard/js/vendor/leaflet.js"></script>
        <script src="{{ STATIC_URL }}publicdashboard/js/leaflet-google.js"></script>
        <!--- if cartodb layer -->
        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v2/themes/css/cartodb.css" />
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v2/themes/css/cartodb.ie.css" />
        <![endif]-->
        <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>

        <link rel="borders" type="application/json" href="js/world_borders.geojson">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div class="wrapper">
          <header>
              <div class="logo" style="float: left">
                  <a href="/"><img src="{{ STATIC_URL }}/img/rsz-logo-plain.png" style="float: left" border="0" Hspace="30" Vspace="5"></a>
              </div>
              <div class="container clearfix">
                  <br><br><br><h2>{% if getProgram %}{{ getProgram.name }}{% endif %}</h2>
              </div>

          </header>
          <div class="container clearfix">
            <div class="widget">
              <h3>Project Sites for {% if getProgram %}{{ getProgram.name }}{% endif %}</h3>
              <style>
                  #map { height: 350px; }
              </style>
              <div id="map"></div>
              <script>
                var country=[];
                var country_lat=[];
                var country_long=[];
                {% for item in countries %}
                    country[{{forloop.counter}}] = "{{ item.country }}";
                    country_lat[{{forloop.counter}}] = "{{ item.latitude }}";
                    country_long[{{forloop.counter}}] = "{{ item.longitude }}";
                {% endfor %}
                var cities = new L.LayerGroup();
                {% for item in getSiteProfile %}
                    L.marker([{{ item.latitude }}, {{ item.longitude }}]).addTo(cities).bindPopup("" + "<b>{{ item.country }}</b> <a href='/activitydb/siteprofile_update/{{ item.id }}'>{{ item.name }}</a> <br/>Province: {{ item.province }} <br/>District: {{ item.district }} <br/> Village: {{ item.village }} <br/> SiteProfile{{ item.name }} <br/> ");
                {%   endfor %}
                var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ';
                var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
                streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});
                var map = L.map('map', {
                center: [country_lat[1], country_long[1]],
                zoom: 5,
                layers: [grayscale, cities]
                });
                var baseLayers = {
                "Grayscale": grayscale,
                "Streets": streets,
                };
                var overlays = {
                "Project Sites": cities,
                };
                L.control.layers(baseLayers, overlays).addTo(map);
               </script>
            </div>
          </div>

            <div class="container clearfix">
              <div class="third widget doughnut">
                  <h3>Project Agreements</h3>
                  <p><a href="" class="button">Filter By Project Agreement</a></p>
                  <div class="canvas-container">
                      <canvas id="hours"></canvas>

                  </div>
                   <div class="chart-legend">
                      <b>Total Projects: {{ total_projects }}</b>
                      <ul>
                          <li class="approve">Approved <b>({{ approved }})</b></li>
                          <li class="wait">Waiting <b>({{ awaiting }})</b></li>
                          <li class="reject">Rejected <b>({{ rejected }})</b></li>
                          <li class="archive">In Progress <b>({{ in_progress }})</b></li>
                      </ul>
                    </div>
              </div>
              <div class="third widget line">
                  <div class="chart-legend">
                      <h3>Key Performance Indicators (KPIs)</h3>
                      <p><span>Targets</span> Vs <strong>Actuals</strong></p>
                  </div>
                  <div class="canvas-container">
                      <!-- create a canvas element for drawing the kpi line chart-->
                      <canvas id="kpi_canvas"></canvas>
                  </div>
              </div>
              <div class="third widget">
                  <div class="chart-legend">
                      <h3>Survey Responses:</h3>
                  </div>
                  <div class="canvas-container">
                      <canvas id="surveys"></canvas>
                  </div>
              </div>
          </div>

          <div class="push"></div>
        </div>


        <script src="{{ STATIC_URL }}publicdashboard/js/vendor/jquery-1.11.1.min.js"></script>
        <script src="{{ STATIC_URL }}publicdashboard/js/plugins.js"></script>
        <script>
            (function(){
            // set up the timeout variable
            var t;
            // setup the sizing function,
            // with an argument that tells the chart to animate or not
            function size(animate){
                // If we are resizing, we don't want the charts drawing on every resize event.
                // This clears the timeout so that we only run the sizing function
                // when we are done resizing the window
                clearTimeout(t);
                // This will reset the timeout right after clearing it.
                t = setTimeout(function(){
                    $("canvas").each(function(i,el){
                        // Set the canvas element's height and width to it's parent's height and width.
                        // The parent element is the div.canvas-container
                        $(el).attr({
                            "width":$(el).parent().width(),
                            "height":$(el).parent().outerHeight()
                        });
                    });
                    // kickoff the redraw function, which builds all of the charts.
                    redraw(animate);
                    // loop through the widgets and find the tallest one, and set all of them to that height.
                    var m = 0;
                    // we have to remove any inline height setting first so that we get the automatic height.
                    $(".widget").height("");
                    $(".widget").each(function(i,el){ m = Math.max(m,$(el).height()); });
                    $(".widget").height(m);
                }, 100); // the timeout should run after 100 milliseconds
            }
            $(window).on('resize', size);
            function redraw(animation){
                var options = {};
                if (!animation){
                    options.animation = false;
                } else {
                    options.animation = true;
                }
                // ....
                    // the rest of our chart drawing will happen here
                // ....
            }
            size(); // this kicks off the first drawing; note that the first call to size will animate the charts in.
            });
            //Doughnut chart
            var data = [
                {
                    value: {{ approved }},
                    color:"#637b85"
                },
                {
                    value : {{ awaiting }},
                    color : "#2c9c69"
                },
                {
                    value : {{ rejected }},
                    color : "#dbba34"
                },
                {
                    value : {{ in_progress }},
                    color : "#c62f29"
                }
            ];
            var canvas = document.getElementById("hours");
            var ctx = canvas.getContext("2d");
            new Chart(ctx).Doughnut(data);

            //create the KPI data object for the KPI line graph - TargetVActuals
            var kpi_data = {

                labels : [{% for indicator in getQuantitativeDataSums|slice:":10" %}  '{{ indicator.indicator__number }}', {% endfor %}],

                datasets : [
                    {
                        label: "KPI Targets",
                        fillColor : "rgba(99,123,133,0.4)",
                        strokeColor : "rgba(220,220,220,1)",
                        pointColor : "rgba(220,220,220,1)",
                        pointStrokeColor : "#fff",
                        data : [ {% for indicator in getQuantitativeDataSums|slice:":10" %}  {{ indicator.targets }}, {% endfor %} ]
                    },
                    {
                        label: "KPI Actuals",
                        fillColor : "rgba(219,186,52,0.4)",
                        strokeColor : "rgba(220,220,220,1)",
                        pointColor : "rgba(220,220,220,1)",
                        pointStrokeColor : "#fff",
                        data : [ {% for indicator in getQuantitativeDataSums|slice:":10" %}  {{ indicator.actuals }}, {% endfor %} ]
                    },
                ]
            }
            //retrieve the context of the kpi canvas, pass the kpi_data into the chart
            var kpi_context = document.getElementById("kpi_canvas").getContext("2d");
            new Chart(kpi_context).Line(kpi_data);

            //Line Graph 2
            var data = {
                labels : ["Helpful","Friendly","Kind","Rude","Slow","Frustrating"],
                datasets : [
                    {
                        fillColor : "rgba(220,220,220,0.5)",
                        strokeColor : "#637b85",
                        pointColor : "#dbba34",
                        pointStrokeColor : "#637b85",
                        data : [65,59,90,81,30,56]
                    }
                ]
            }
            var canvas = document.getElementById("surveys");
            var ctx = canvas.getContext("2d");
            new Chart(ctx).Radar(data);
        </script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X','auto');ga('send','pageview');
        </script>
    </body>
</html>

