{% extends "base.html" %}
{% block bread_crumb %}
<ol class="breadcrumb">
  <li><a href="/activitydb/dashboard/0/">Program Dashboards</a></li>
  <li><a href="/activitydb/dashboard/project/{{ project_proposal_id }}/">Project Dashboards</a></li>
  <li class="active">Communites</li>
</ol>
{% endblock %}
{% load group_tag %}
{% block page_title %}Community List{% endblock %}

{% block content %}
<div>
{% if request.user|has_group:"Editor" %}
    <a href="/activitydb/community_add" class="btn btn-large btn-success">New Community</a> &nbsp;
    <a href="/activitydb/community_import" class="btn btn-large btn-info">Import Community</a>
{% endif %}
<hr/>
</div>
<style>
    #map { height: 480px; }
</style>

<form action="#" method="post">
<p>Zoom to Region: 	<select id="region" onchange="ZoomToCountry(this.value);">
				<option value="1">All Regions</option>
				<option>East & Southern Africa</option>
				<option>Central & South Asia</option>
				<option>West & Central Africa</option>
				<option>East Asia</option>
				<option>Latin America, Caribbean, Balkans, Caucasus</option>
				<option>Middle East</option>
			</select></p>
</form>
<p><b>Communities</b></p>
<div id="map"></div>

<script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>

<script type="text/javascript">

    var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>',
        thunLink = '<a href="http://thunderforest.com/">Thunderforest</a>';

    var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        osmAttrib = '&copy; ' + osmLink + ' Contributors',
        osmHumURL = "http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",
        osmHumAttrib = "Â© OpenStreetMap Contributors. Tiles courtesy of Humanitarian OpenStreetMap Team",
        landUrl = 'http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png',
        thunAttrib = '&copy; '+osmLink+' Contributors & '+thunLink;

    var osmMap = L.tileLayer(osmUrl, {attribution: osmAttrib}),
        landMap = L.tileLayer(landUrl, {attribution: thunAttrib}),
        osmHumMap = L.tileLayer(osmHumURL, {attribution: osmHumAttrib});

    var map = L.map('map', {
            layers: [osmMap] // only add one!
        }).setView([0.0, -0.09], 2);

    var baseLayers = {
			"OSM Mapnik": osmMap,
            "OSM Humanitarian": osmHumMap,
			"Landscape": landMap
		};


	L.control.layers(baseLayers).addTo(map);

    {% for item in getCommunity %}
        L.marker([{{ item.latitude }}, {{ item.longitude }}]).addTo(map).bindPopup("" + "<b>{{ item.country }}</b> <a href='/activitydb/community_update/{{ item.id }}'>{{ item.name }}</a> <br/>Province: {{ incident.province }} <br/>District: {{ item.district }} <br/> Village: {{ item.village }} <br/> Community: {{ item.name }} <br/> ").openPopup();
    {%   endfor %}

    function ZoomToCountry(region){
        if(region == "Latin America, Caribbean, Balkans, Caucasus"){
            map.setView([9,-60], 4);
        }else if(region == "East Asia"){
            map.setView([30,96], 4);
        }else if(region == "Central & South Asia"){
            map.setView([30,80], 4);
        }else if(region == "East & Southern Africa"){
            map.setView([10,10], 4);
        }else if(region == "West & Central Africa"){
            map.setView([10,10], 4);
        }else if(region == "Latin America, Caribbean, Balkans, Caucasus"){
            map.setView([30,20], 4);
        }else if(region == "Middle East"){
            map.setView([30,20], 4);
        }else if(region == "1"){
            map.setView([10,-10], 2);
        };
    }
</script>

<ul class="list-group">
{% for item in getCommunity %}
    <li class="list-group-item"><b>{{ item.create_date|date }} - {{ item.name }}</b></li>
    {% if request.user|has_group:"Editor" %}
        <li class="list-group-item"><a href="/activitydb/community_update/{{ item.id }}" class="btn btn-sm btn-warning">Update Community</a> <a href="/activitydb/community_delete/{{ item.id }}" class="btn btn-sm btn-danger">Delete Community</a></li>
    {% endif %}
{% empty %}
    <li class="list-group-item">No communities yet.</li>
{% endfor %}
</ul>
{% endblock content %}