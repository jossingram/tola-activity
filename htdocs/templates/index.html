{% extends "base.html" %}

{% block content %}

<script src="{{ STATIC_URL }}js/highcharts/js/highcharts.js"></script>
<script src="{{ STATIC_URL }}js/highcharts/js/modules/exporting.js"></script>

<script>

$(function () {
    $('#container').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Program Activites by Status {% if getFilteredName %} for {{ getFilteredName }} {% endif %}</b></p>'
        },
        xAxis: {
            categories: ['Proposals', 'Agreements', 'Completions']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Number of Approved, Pending or Open Activities'
            }
        },
        legend: {
            reversed: true
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: [
        {
            name: 'Approved',
            data: [{{ proposal_approved_count }}, {{ agreement_approved_count }}, {{ complete_approved_count }}]
        },
        {
            name: 'Pending',
            data: [{{ proposal_wait_count }}, {{ agreement_wait_count }}, {{ complete_wait_count }}]
        },
        {
            name: 'Open',
            data: [{{ proposal_total_count }}, {{ agreement_total_count }}, {{ complete_total_count }}]
        },
        ]
    });
});

</script>

<div class="container">
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-body">
                <div style="float:left;">
                    <h4>Tola-Activity Dashboard</h4>
                </div>
                <div style="float:right; display: inline-block; vertical-align: middle;">
                    <a href="/activitydb/projectproposal_add/0/" class="btn btn-sm btn-success">Create a Project Proposal</a>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <!-- Extra small button group -->
                    <div class="btn-group">
                      <button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                        Filter Program List by Sector <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu" role="menu">
                         {%for sector in getSectors%}
                            <li class="list-group-item">
                                <a href="/dashboard/{% if getFilteredName %}{{ getFilteredName.id }}{% else %}0{% endif %}/{{ sector.id }}/">{{ sector.sector }}</a>
                            </li>
                        {%endfor%}
                      </ul>
                    </div>
                </div>
                <div class="panel-body">
                    <ul class="list-group">
                    {%for program in programs%}
                        <li class="list-group-item">
                            <a href="/activitydb/dashboard/{{ program.id }}/">{{ program.name }}</a>&nbsp;
                            <button type="button" class="btn btn-xs btn-success" style="float:right; vertical-align: middle;" onclick="location.href='/dashboard/{{ program.id }}/'"><span class="glyphicon glyphicon-arrow-right"></span></button>
                        </li>
                    {%endfor%}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-body">
                    <p><b>Communities {% if getFilteredName %} for {{ getFilteredName }} {% endif %}</b></p>
                    <style>
                        #map { height: 350px; }
                    </style>
                    <div id="map"></div>

                    {% include "small_community_map.html" %}

                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div id="container" style=" width: 100%; height: 400px; margin: 0 auto; float:right"></div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock content %}
